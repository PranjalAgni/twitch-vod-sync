(this["webpackJsonptwitch-vod-sync"]=this["webpackJsonptwitch-vod-sync"]||[]).push([[0],{11:function(e,t,a){e.exports=a(19)},16:function(e,t,a){},17:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(9),o=a.n(r),s=(a(16),a(2)),c=a(3),u=a(5),l=a(4),d=(a(17),a(6)),h=a.n(d),v=a(10),p=a(1);function m(e,t){for(var a=""+e;a.length<t;)a="0"+a;return a}function f(e){return e.getFullYear()+"-"+m(e.getMonth()+1,2)+"-"+m(e.getDate(),2)+" "+m(e.getHours(),2)+":"+m(e.getMinutes(),2)+":"+m(e.getSeconds(),2)}function w(e){var t=e.match(/(?:([0-9]+)h)?([0-9]+)m([0-9]+)s/);if(!t)throw Error("Invalid duration");return 3600*Number(t[1])+60*Number(t[2])+Number(t[3])}var y=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).inputRef=void 0,n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.inputRef=i.a.createRef(),n}return Object(c.a)(a,[{key:"handleSubmit",value:function(e){if(e.preventDefault(),this.inputRef.current){var t=this.inputRef.current.value,a=t.match(/^(?:https?:\/\/(?:www\.|m\.)?twitch\.tv\/videos\/)?([0-9]+)$/);if(a){var n=Number(a[1]);console.log("Picked video: ",t," ",n),this.props.onVideoPicked(n)}else console.log("Wrong URL: ",t)}else console.error("No inputRef")}},{key:"render",value:function(){return i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement("input",{type:"text",name:"video",ref:this.inputRef,placeholder:"Twitch video URL"}),i.a.createElement("input",{type:"submit",value:"Watch"}))}}]),a}(i.a.PureComponent),b=a(7);function k(e){var t=Array.from(e.videos.values()),a=new Date(Math.min.apply(Math,Object(b.a)(t.map((function(e){return e.startDate.getTime()}))))),n=new Date(Math.max.apply(Math,Object(b.a)(t.map((function(e){return e.startDate.getTime()+1e3*e.duration})))));return i.a.createElement("div",{className:"timestamps"},i.a.createElement("div",null,f(a)),i.a.createElement("div",null,e.currentPosition?f(e.currentPosition):void 0),i.a.createElement("div",null,f(n)))}var g=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).interval=void 0,n.player=void 0,n.state=n.initialState(),n.interval=void 0,n.player=void 0,n.handleVideoPicked=n.handleVideoPicked.bind(Object(p.a)(n)),n.updateTimestamp=n.updateTimestamp.bind(Object(p.a)(n)),n}return Object(c.a)(a,[{key:"initialState",value:function(){return{}}},{key:"handleVideoPicked",value:function(){var e=Object(v.a)(h.a.mark((function e(t){var a,n,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({video:t}),e.next=3,fetch("https://api.twitch.tv/helix/videos?id="+t,{headers:{"Client-ID":this.props.clientId,Authorization:"Bearer "+this.props.accessToken}});case 3:if(200!==(a=e.sent).status){e.next=11;break}return e.next=7,a.json();case 7:n=e.sent,i=n.data[0],console.log("Got video date: ",i.created_at),this.setState({videoDate:new Date(i.created_at),videoDuration:w(i.duration)});case 11:this.player=new Twitch.Player("player"+this.props.id,{width:"100%",height:"100%",video:t}),this.player.addEventListener(Twitch.Player.READY,this.updateTimestamp),this.player.addEventListener(Twitch.Player.PLAYING,this.updateTimestamp),this.player.addEventListener(Twitch.Player.PAUSE,this.updateTimestamp),this.interval=window.setInterval(this.updateTimestamp,1e3);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.clearInterval(this.interval),this.interval=void 0}},{key:"updateTimestamp",value:function(){if(this.state.videoDate&&this.player){var e=this.state.videoDate.getTime();e+=1e3*this.player.getCurrentTime(),this.setState({currentPosition:new Date(e)})}}},{key:"render",value:function(){if(this.state.video){var e;if(this.state.videoDate&&this.state.videoDuration){var t=new Map([[1,{startDate:this.state.videoDate,duration:this.state.videoDuration}]]);e=i.a.createElement(k,{currentPosition:this.state.currentPosition,videos:t})}return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"player"+this.props.id,className:"player"}),e)}return i.a.createElement(y,{onVideoPicked:this.handleVideoPicked})}}]),a}(i.a.PureComponent),E=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state=n.initialState(),n}return Object(c.a)(a,[{key:"initialState",value:function(){var e=window.location.hash.match(/#access_token=([^&]+)/),t=null;return e&&e[1]&&(t=e[1],console.log("Got access token: ",t)),{accessToken:t}}},{key:"render",value:function(){return this.state.accessToken?i.a.createElement(g,{id:1,clientId:"r69vc9claq1m3n960hrkuszot4nx54",accessToken:this.state.accessToken}):(setTimeout((function(){window.location.href="https://id.twitch.tv/oauth2/authorize?client_id=r69vc9claq1m3n960hrkuszot4nx54&redirect_uri=https://remram44.github.io/twitch-vod-sync/&response_type=token&scope="}),2e3),i.a.createElement("p",null,"Redirecting you to Twitch to authorize use of their API..."))}}]),a}(i.a.PureComponent);function T(){return i.a.createElement(E,null)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(T,null)),document.getElementById("app")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[11,1,2]]]);
//# sourceMappingURL=main.eea20466.chunk.js.map