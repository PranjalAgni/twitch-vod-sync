(this["webpackJsonptwitch-vod-sync"]=this["webpackJsonptwitch-vod-sync"]||[]).push([[0],{11:function(e,t,i){e.exports=i(19)},16:function(e,t,i){},17:function(e,t,i){},19:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),r=i(9),s=i.n(r),o=(i(16),i(2)),l=i(3),c=i(1),h=i(5),d=i(4),u=(i(17),i(7));function p(e,t){for(var i=""+e;i.length<t;)i="0"+i;return i}function v(e){return e.getFullYear()+"-"+p(e.getMonth()+1,2)+"-"+p(e.getDate(),2)+" "+p(e.getHours(),2)+":"+p(e.getMinutes(),2)+":"+p(e.getSeconds(),2)}function m(e){var t=e.match(/(?:([0-9]+)h)?([0-9]+)m([0-9]+)s/);if(t)return t[1]?3600*parseInt(t[1])+60*parseInt(t[2])+parseInt(t[3]):60*parseInt(t[2])+parseInt(t[3]);throw Error("Invalid duration")}function f(e){if(0===e.videos.size)return n.a.createElement("div",{className:"timestamps"});var t=Array.from(e.videos.values()),i=new Date(Math.min.apply(Math,Object(u.a)(t.map((function(e){return e.startDate.getTime()}))))),a=new Date(Math.max.apply(Math,Object(u.a)(t.map((function(e){return e.startDate.getTime()+1e3*e.duration})))));return n.a.createElement("div",{className:"timestamps"},n.a.createElement("div",null,v(i)),n.a.createElement("div",null,e.currentPosition?v(e.currentPosition):void 0),n.a.createElement("div",null,v(a)))}var y=i(6),w=i.n(y),g=i(10),b=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(o.a)(this,i),(a=t.call(this,e)).inputRef=void 0,a.handleSubmit=a.handleSubmit.bind(Object(c.a)(a)),a.inputRef=n.a.createRef(),a}return Object(l.a)(i,[{key:"handleSubmit",value:function(e){if(e.preventDefault(),this.inputRef.current){var t=this.inputRef.current.value,i=t.match(/^(?:https?:\/\/(?:www\.|m\.)?twitch\.tv\/videos\/)?([0-9]+)$/);if(i){var a=parseInt(i[1]);console.log("Picked video: ",t," ",a),this.props.onVideoPicked(a)}else console.log("Wrong URL: ",t)}else console.error("No inputRef")}},{key:"render",value:function(){return n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement("input",{type:"text",name:"video",ref:this.inputRef,placeholder:"Twitch video URL"}),n.a.createElement("input",{type:"submit",value:"Watch"}))}}]),i}(n.a.PureComponent),k=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(o.a)(this,i),(a=t.call(this,e)).player=void 0,a.playerState=void 0,a.interval=void 0,a.state=a.initialState(),a.player=void 0,a.playerState=void 0,a.handleVideoPicked=a.handleVideoPicked.bind(Object(c.a)(a)),a.updateTimestamp=a.updateTimestamp.bind(Object(c.a)(a)),a}return Object(l.a)(i,[{key:"initialState",value:function(){return{}}},{key:"handleVideoPicked",value:function(){var e=Object(g.a)(w.a.mark((function e(t){var i,a,n,r,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({video:t}),e.next=3,fetch("https://api.twitch.tv/helix/videos?id="+t,{headers:{"Client-ID":this.props.clientId,Authorization:"Bearer "+this.props.accessToken}});case 3:if(200!==(i=e.sent).status){e.next=14;break}return e.next=7,i.json();case 7:a=e.sent,n=a.data[0],console.log("Got video date: ",n.created_at),r=new Date(n.created_at),s=m(n.duration),this.setState({videoDate:r,videoDuration:s}),this.props.setVideoInfo(this.props.id,{startDate:r,duration:s});case 14:this.player=new Twitch.Player("player"+this.props.id,{width:"100%",height:"100%",video:t}),this.player.addEventListener(Twitch.Player.READY,this.updateTimestamp),this.player.addEventListener(Twitch.Player.PLAYING,this.updateTimestamp),this.player.addEventListener(Twitch.Player.PAUSE,this.updateTimestamp),console.log("Created player",this.player),this.interval=window.setInterval(this.updateTimestamp,1e3);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){void 0!==this.interval&&(window.clearInterval(this.interval),this.interval=void 0)}},{key:"updateTimestamp",value:function(){if(this.state.videoDate&&this.player){var e=new Date(this.state.videoDate.getTime()+1e3*this.player.getCurrentTime());this.player.isPaused()?this.playerStateChanged({state:"paused",position:e}):this.playerStateChanged({state:"playing",offset:(e.getTime()-(new Date).getTime())/1e3})}}},{key:"playerStateChanged",value:function(e){if(void 0!==this.playerState)if("paused"===e.state&&"paused"===this.playerState.state){var t=this.playerState.position.getTime()-e.position.getTime();if(Math.abs(t)<=.8)return!1}else if("playing"===e.state&&"playing"===this.playerState.state){var i=this.playerState.offset-e.offset;if(Math.abs(i)<=.8)return!1}return console.log("update state"),this.playerState=e,this.props.onChange(this.props.id,e),!0}},{key:"render",value:function(){return this.state.video?n.a.createElement("div",{id:"player"+this.props.id,className:"player",style:{width:this.props.width+"px",height:this.props.height+"px"}}):n.a.createElement("div",{style:{width:this.props.width+"px",height:this.props.height+"px"}},n.a.createElement(b,{onVideoPicked:this.handleVideoPicked}))}}]),i}(n.a.PureComponent),S=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(o.a)(this,i),(a=t.call(this,e)).interval=void 0,a.state=a.initialState(),a.interval=window.setInterval(a.computeCurrentPosition.bind(Object(c.a)(a)),1e3),a.setVideoInfo=a.setVideoInfo.bind(Object(c.a)(a)),a.handlePlayerStateChange=a.handlePlayerStateChange.bind(Object(c.a)(a)),a.resized=a.resized.bind(Object(c.a)(a)),window.addEventListener("resize",a.resized),a}return Object(l.a)(i,[{key:"initialState",value:function(){var e=window.location.hash.match(/#access_token=([^&]+)/),t=null;return e&&e[1]&&(t=e[1],console.log("Got access token: ",t)),{accessToken:t,videos:new Map,width:window.innerWidth/2-6,height:window.innerHeight-20-6}}},{key:"componentWillUnmount",value:function(){void 0!==this.interval&&(window.clearInterval(this.interval),this.interval=void 0),window.removeEventListener("resize",this.resized)}},{key:"resized",value:function(){this.setState({width:window.innerWidth/2-6,height:window.innerHeight-20-6})}},{key:"setVideoInfo",value:function(e,t){console.log("setVideoInfo: ",e,", ",t),this.setState((function(i){var a=new Map(i.videos);return a.set(e,t),{videos:a}}))}},{key:"handlePlayerStateChange",value:function(e,t){this.setState({playerState:t}),this.computeCurrentPosition()}},{key:"computeCurrentPosition",value:function(){this.setState((function(e){var t,i,a;if("paused"===(null===(t=e.playerState)||void 0===t?void 0:t.state))a=e.playerState.position;else{if("playing"!==(null===(i=e.playerState)||void 0===i?void 0:i.state))return{};a=new Date((new Date).getTime()+1e3*e.playerState.offset)}return{currentPosition:a}}))}},{key:"render",value:function(){return this.state.accessToken?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"container"},n.a.createElement(k,{id:1,clientId:"r69vc9claq1m3n960hrkuszot4nx54",accessToken:this.state.accessToken,setVideoInfo:this.setVideoInfo,onChange:this.handlePlayerStateChange,width:this.state.width,height:this.state.height}),n.a.createElement(k,{id:2,clientId:"r69vc9claq1m3n960hrkuszot4nx54",accessToken:this.state.accessToken,setVideoInfo:this.setVideoInfo,onChange:this.handlePlayerStateChange,width:this.state.width,height:this.state.height})),n.a.createElement(f,{currentPosition:this.state.currentPosition,videos:this.state.videos})):(setTimeout((function(){window.location.href="https://id.twitch.tv/oauth2/authorize?client_id=r69vc9claq1m3n960hrkuszot4nx54&redirect_uri=https://remram44.github.io/twitch-vod-sync/&response_type=token&scope="}),2e3),n.a.createElement("p",null,"Redirecting you to Twitch to authorize use of their API..."))}}]),i}(n.a.PureComponent);var P=function(){return n.a.createElement(S,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(P,null)),document.getElementById("app")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[11,1,2]]]);
//# sourceMappingURL=main.5164f894.chunk.js.map